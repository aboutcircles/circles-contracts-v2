<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>EIP712</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="../../../src/circles/index.html">❱ circles</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/circles/Circles.sol/contract.Circles.html">Circles</a></li><li class="chapter-item "><a href="../../../src/circles/Demurrage.sol/contract.Demurrage.html">Demurrage</a></li><li class="chapter-item "><a href="../../../src/circles/DiscountedBalances.sol/contract.DiscountedBalances.html">DiscountedBalances</a></li><li class="chapter-item "><a href="../../../src/circles/ERC1155.sol/abstract.ERC1155.html">ERC1155</a></li><li class="chapter-item "><a href="../../../src/circles/ICircles.sol/interface.ICircles.html">ICircles</a></li><li class="chapter-item "><a href="../../../src/circles/IDemurrage.sol/interface.IDemurrage.html">IDemurrage</a></li></ol></li><li class="chapter-item "><a href="../../../src/errors/index.html">❱ errors</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/errors/Errors.sol/interface.IHubErrors.html">IHubErrors</a></li><li class="chapter-item "><a href="../../../src/errors/Errors.sol/interface.ICirclesDemurrageErrors.html">ICirclesDemurrageErrors</a></li><li class="chapter-item "><a href="../../../src/errors/Errors.sol/interface.ICirclesErrors.html">ICirclesErrors</a></li><li class="chapter-item "><a href="../../../src/errors/Errors.sol/interface.IStandardTreasuryErrors.html">IStandardTreasuryErrors</a></li><li class="chapter-item "><a href="../../../src/errors/Errors.sol/interface.INameRegistryErrors.html">INameRegistryErrors</a></li></ol></li><li class="chapter-item "><a href="../../../src/groups/index.html">❱ groups</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/groups/BaseMintPolicy.sol/contract.MintPolicy.html">MintPolicy</a></li><li class="chapter-item "><a href="../../../src/groups/Definitions.sol/contract.BaseMintPolicyDefinitions.html">BaseMintPolicyDefinitions</a></li><li class="chapter-item "><a href="../../../src/groups/IMintPolicy.sol/interface.IMintPolicy.html">IMintPolicy</a></li></ol></li><li class="chapter-item "><a href="../../../src/hub/index.html">❱ hub</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/hub/Hub.sol/contract.Hub.html">Hub</a></li><li class="chapter-item "><a href="../../../src/hub/IHub.sol/interface.IHubV2.html">IHubV2</a></li><li class="chapter-item "><a href="../../../src/hub/TypeDefinitions.sol/contract.TypeDefinitions.html">TypeDefinitions</a></li></ol></li><li class="chapter-item "><a href="../../../src/lib/index.html">❱ lib</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/lib/Math64x64.sol/library.Math64x64.html">Math64x64</a></li></ol></li><li class="chapter-item expanded "><a href="../../../src/lift/index.html">❱ lift</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/lift/DemurrageCircles.sol/contract.DemurrageCircles.html">DemurrageCircles</a></li><li class="chapter-item expanded "><a href="../../../src/lift/EIP712.sol/abstract.EIP712.html" class="active">EIP712</a></li><li class="chapter-item "><a href="../../../src/lift/ERC20DiscountedBalances.sol/contract.ERC20DiscountedBalances.html">ERC20DiscountedBalances</a></li><li class="chapter-item "><a href="../../../src/lift/ERC20InflationaryBalances.sol/contract.ERC20InflationaryBalances.html">ERC20InflationaryBalances</a></li><li class="chapter-item "><a href="../../../src/lift/ERC20Lift.sol/contract.ERC20Lift.html">ERC20Lift</a></li><li class="chapter-item "><a href="../../../src/lift/ERC20Permit.sol/contract.ERC20Permit.html">ERC20Permit</a></li><li class="chapter-item "><a href="../../../src/lift/IERC20Lift.sol/enum.CirclesType.html">CirclesType</a></li><li class="chapter-item "><a href="../../../src/lift/IERC20Lift.sol/interface.IERC20Lift.html">IERC20Lift</a></li><li class="chapter-item "><a href="../../../src/lift/InflationaryCircles.sol/contract.InflationaryCircles.html">InflationaryCircles</a></li></ol></li><li class="chapter-item "><a href="../../../src/migration/index.html">❱ migration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/migration/IHub.sol/interface.IHubV1.html">IHubV1</a></li><li class="chapter-item "><a href="../../../src/migration/IToken.sol/interface.ITokenV1.html">ITokenV1</a></li><li class="chapter-item "><a href="../../../src/migration/Migration.sol/contract.Migration.html">Migration</a></li></ol></li><li class="chapter-item "><a href="../../../src/names/index.html">❱ names</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/names/Base58Converter.sol/contract.Base58Converter.html">Base58Converter</a></li><li class="chapter-item "><a href="../../../src/names/INameRegistry.sol/interface.INameRegistry.html">INameRegistry</a></li><li class="chapter-item "><a href="../../../src/names/NameRegistry.sol/contract.NameRegistry.html">NameRegistry</a></li></ol></li><li class="chapter-item "><a href="../../../src/operators/index.html">❱ operators</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/operators/BaseOperator.sol/contract.BaseOperator.html">BaseOperator</a></li><li class="chapter-item "><a href="../../../src/operators/SignedPathOperator.sol/contract.SignedPathOperator.html">SignedPathOperator</a></li></ol></li><li class="chapter-item "><a href="../../../src/proxy/index.html">❱ proxy</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/proxy/MasterCopyNonUpgradable.sol/contract.MasterCopyNonUpgradable.html">MasterCopyNonUpgradable</a></li><li class="chapter-item "><a href="../../../src/proxy/Proxy.sol/interface.IProxy.html">IProxy</a></li><li class="chapter-item "><a href="../../../src/proxy/Proxy.sol/contract.Proxy.html">Proxy</a></li><li class="chapter-item "><a href="../../../src/proxy/ProxyFactory.sol/contract.ProxyFactory.html">ProxyFactory</a></li></ol></li><li class="chapter-item "><a href="../../../src/treasury/index.html">❱ treasury</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../src/treasury/IStandardVault.sol/interface.IStandardVault.html">IStandardVault</a></li><li class="chapter-item "><a href="../../../src/treasury/StandardTreasury.sol/contract.StandardTreasury.html">StandardTreasury</a></li><li class="chapter-item "><a href="../../../src/treasury/StandardVault.sol/contract.StandardVault.html">StandardVault</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/aboutcircles/circles-contracts-v2" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="eip712"><a class="header" href="#eip712">EIP712</a></h1>
<p><a href="https://github.com/aboutcircles/circles-contracts-v2/blob/9fbbffb44eda7934ea8adf9354e5f09f6b15b8b2/src/lift/EIP712.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
IERC5267</p>
<p><em>https://eips.ethereum.org/EIPS/eip-712[EIP 712] is a standard for hashing and signing of typed structured data.
The encoding scheme specified in the EIP requires a domain separator and a hash of the typed structured data, whose
encoding is very generic and therefore its implementation in Solidity is not feasible, thus this contract
does not implement the encoding itself. Protocols need to implement the type-specific encoding they need in order to
produce the hash of their typed data using a combination of <code>abi.encode</code> and <code>keccak256</code>.
This contract implements the EIP 712 domain separator (<a href="/src/lift/EIP712.sol/abstract.EIP712.html#_domainseparatorv4">_domainSeparatorV4</a>) that is used as part of the encoding
scheme, and the final step of the encoding to obtain the message digest that is then signed via ECDSA
({_hashTypedDataV4}).
The implementation of the domain separator was designed to be as efficient as possible while still properly updating
the chain id to protect against replay attacks on an eventual fork of the chain.
NOTE: This contract implements the version of the encoding known as "v4", as implemented by the JSON RPC method
https://docs.metamask.io/guide/signing-data.html[<code>eth_signTypedDataV4</code> in MetaMask].
NOTE: In the upgradeable version of this contract, the cached values will correspond to the address, and the domain
separator of the implementation contract. This will cause the {_domainSeparatorV4} function to always rebuild the
separator from the immutable values, which is cheaper than accessing a cached version in cold storage.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="type_hash"><a class="header" href="#type_hash">TYPE_HASH</a></h3>
<pre><code class="language-solidity">bytes32 private constant TYPE_HASH =
    keccak256("EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)");
</code></pre>
<h3 id="_cacheddomainseparator"><a class="header" href="#_cacheddomainseparator">_cachedDomainSeparator</a></h3>
<pre><code class="language-solidity">bytes32 private _cachedDomainSeparator;
</code></pre>
<h3 id="_cachedchainid"><a class="header" href="#_cachedchainid">_cachedChainId</a></h3>
<pre><code class="language-solidity">uint256 private _cachedChainId;
</code></pre>
<h3 id="_cachedthis"><a class="header" href="#_cachedthis">_cachedThis</a></h3>
<pre><code class="language-solidity">address private _cachedThis;
</code></pre>
<h3 id="_hashedname"><a class="header" href="#_hashedname">_hashedName</a></h3>
<pre><code class="language-solidity">bytes32 private _hashedName;
</code></pre>
<h3 id="_hashedversion"><a class="header" href="#_hashedversion">_hashedVersion</a></h3>
<pre><code class="language-solidity">bytes32 private _hashedVersion;
</code></pre>
<h3 id="_name"><a class="header" href="#_name">_name</a></h3>
<pre><code class="language-solidity">ShortString private _name;
</code></pre>
<h3 id="_version"><a class="header" href="#_version">_version</a></h3>
<pre><code class="language-solidity">ShortString private _version;
</code></pre>
<h3 id="_namefallback"><a class="header" href="#_namefallback">_nameFallback</a></h3>
<pre><code class="language-solidity">string private _nameFallback;
</code></pre>
<h3 id="_versionfallback"><a class="header" href="#_versionfallback">_versionFallback</a></h3>
<pre><code class="language-solidity">string private _versionFallback;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="_setupeip712"><a class="header" href="#_setupeip712">_setupEIP712</a></h3>
<p>*Initializes the domain separator and parameter caches.
The meaning of <code>name</code> and <code>version</code> is specified in
https://eips.ethereum.org/EIPS/eip-712#definition-of-domainseparator[EIP 712]:</p>
<ul>
<li><code>name</code>: the user readable name of the signing domain, i.e. the name of the DApp or the protocol.</li>
<li><code>version</code>: the current major version of the signing domain.
NOTE: These parameters cannot be changed except through a xref:learn::upgrading-smart-contracts.adoc[smart
contract upgrade].*</li>
</ul>
<pre><code class="language-solidity">function _setupEIP712(string memory name, string memory version) internal;
</code></pre>
<h3 id="eip712domain"><a class="header" href="#eip712domain">eip712Domain</a></h3>
<p><em>See {IERC-5267}.</em></p>
<pre><code class="language-solidity">function eip712Domain()
    public
    view
    virtual
    returns (
        bytes1 fields,
        string memory name,
        string memory version,
        uint256 chainId,
        address verifyingContract,
        bytes32 salt,
        uint256[] memory extensions
    );
</code></pre>
<h3 id="_domainseparatorv4"><a class="header" href="#_domainseparatorv4">_domainSeparatorV4</a></h3>
<p><em>Returns the domain separator for the current chain.</em></p>
<pre><code class="language-solidity">function _domainSeparatorV4() internal view returns (bytes32);
</code></pre>
<h3 id="_hashtypeddatav4"><a class="header" href="#_hashtypeddatav4">_hashTypedDataV4</a></h3>
<p>*Given an already https://eips.ethereum.org/EIPS/eip-712#definition-of-hashstruct[hashed struct], this
function returns the hash of the fully encoded EIP712 message for this domain.
This hash can be used together with <a href="/lib/openzeppelin-contracts/contracts/utils/cryptography/ECDSA.sol/library.ECDSA.html#recover">ECDSA-recover</a> to obtain the signer of a message. For example:</p>
<pre><code class="language-solidity">bytes32 digest = _hashTypedDataV4(keccak256(abi.encode(
keccak256("Mail(address to,string contents)"),
mailTo,
keccak256(bytes(mailContents))
)));
address signer = ECDSA.recover(digest, signature);
```*


```solidity
function _hashTypedDataV4(bytes32 structHash) internal view virtual returns (bytes32);
</code></pre>
<h3 id="_eip712name"><a class="header" href="#_eip712name">_EIP712Name</a></h3>
<p><em>The name parameter for the EIP712 domain.
NOTE: By default this function reads _name which is an immutable value.
It only reads from storage if necessary (in case the value is too large to fit in a ShortString).</em></p>
<pre><code class="language-solidity">function _EIP712Name() internal view returns (string memory);
</code></pre>
<h3 id="_eip712version"><a class="header" href="#_eip712version">_EIP712Version</a></h3>
<p><em>The version parameter for the EIP712 domain.
NOTE: By default this function reads _version which is an immutable value.
It only reads from storage if necessary (in case the value is too large to fit in a ShortString).</em></p>
<pre><code class="language-solidity">function _EIP712Version() internal view returns (string memory);
</code></pre>
<h3 id="_builddomainseparator"><a class="header" href="#_builddomainseparator">_buildDomainSeparator</a></h3>
<pre><code class="language-solidity">function _buildDomainSeparator() private view returns (bytes32);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../src/lift/DemurrageCircles.sol/contract.DemurrageCircles.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../src/lift/ERC20DiscountedBalances.sol/contract.ERC20DiscountedBalances.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../src/lift/DemurrageCircles.sol/contract.DemurrageCircles.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../src/lift/ERC20DiscountedBalances.sol/contract.ERC20DiscountedBalances.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
